# ぼくの読書きろく - 要件定義書

## 1. プロジェクト概要

| 項目 | 内容 |
|------|------|
| プロジェクト名 | ぼくの読書きろく |
| 目的 | 小学校低学年の子供が自分で読んだ本を記録・管理できるWebアプリケーションの開発 |
| 対象ユーザー | 小学校低学年（6〜8歳）の児童 |
| 利用環境 | スマートフォン・タブレット・パソコンのブラウザ（家庭内Wi-Fi環境） |

## 2. システム構成

### 2.1 技術スタック

| 項目 | 技術 |
|------|------|
| フロントエンド | React |
| バックエンド | Python (Django) |
| データベース | PostgreSQL |
| 書籍情報API | NDLサーチ OpenSearch API（フォールバック: Google Books API） |

### 2.2 Docker構成

本アプリケーションはDocker Composeを使用してコンテナ化し、以下の3つのコンテナで構成します。

#### 2.2.1 コンテナ構成

| コンテナ名 | 役割 | ベースイメージ | ポート |
|----------|------|--------------|--------|
| frontend | Reactアプリケーション | node:18-alpine | 3000 |
| backend | Django APIサーバー | python:3.11-slim | 8000 |
| db | PostgreSQLデータベース | postgres:15 | 5432 |

#### 2.2.2 ディレクトリ構成

```
bokuno-dokusho-kiroku/
├── docker-compose.yml          # 全体のオーケストレーション
├── frontend/                   # Reactアプリ
│   ├── Dockerfile
│   ├── package.json
│   ├── public/
│   └── src/
├── backend/                    # Djangoアプリ
│   ├── Dockerfile
│   ├── requirements.txt
│   ├── manage.py
│   └── books/                  # Djangoアプリケーション
└── README.md                   # セットアップ手順
```

#### 2.2.3 ネットワーク構成

- **内部ネットワーク**: Docker Compose内でapp-networkを作成
- **外部アクセス**: フロントエンドのポート3000を家庭内Wi-Fiに公開
- **コンテナ間通信**: 内部DNSによる名前解決（backend、db等）

#### 2.2.4 データ永続化

- **PostgreSQLデータ**: Dockerボリューム（postgres-data）にマウント
- **保存場所**: サーバー役端末のローカルストレージ
- **バックアップ**: `docker exec` コマンドでpg_dumpを実行可能

### 2.3 デプロイメント構成

- **サーバー役端末**: 使用時のみ起動するローカルサーバー
- **起動方法**: `docker-compose up` コマンドで全コンテナを一括起動
- **停止方法**: `docker-compose down` コマンドで全コンテナを一括停止
- **ネットワーク**: 家庭内Wi-Fi（同一ネットワーク内からのアクセスのみ）
- **データ保存**: PostgreSQLにて、ユーザーが削除するまで永続的に保存
- **必要環境**: Docker Desktop（Windows/Mac）またはDocker Engine（Linux）

## 3. 機能要件

### 3.1 画面一覧

| No. | 画面名 | 概要 |
|-----|--------|------|
| 1 | メニュー画面 | 各機能へのナビゲーション |
| 2 | 本の登録画面（バーコード） | カメラでバーコードをスキャンして本を登録 |
| 3 | 本の登録画面（手動入力） | ISBNコードを手動入力して本を登録 |
| 4 | 本の一覧画面 | 登録済みの本を一覧表示・削除 |
| 5 | 検索画面 | 本のタイトルで部分一致検索 |

### 3.2 各画面の詳細仕様

#### 3.2.1 メニュー画面

**目的**: 各機能へのナビゲーションを提供

**表示要素**:
- アプリタイトル「ぼくの読書きろく」
- 「ほんをとうろくする（バーコード）」ボタン
- 「ほんをとうろくする（てにゅうりょく）」ボタン
- 「ほんのいちらん」ボタン
- 「ほんをさがす」ボタン

**動作**:
- 各ボタンをタップすると対応する画面に遷移

#### 3.2.2 本の登録画面（バーコード）

**目的**: カメラでバーコードをスキャンして本を登録

**表示要素**:
- カメラプレビュー（バーコードスキャンエリア）
- 「スキャンする」ボタン
- 「メニューにもどる」ボタン

**動作**:
1. カメラを起動してバーコードをスキャン
2. ISBNコードを読み取り
3. NDLサーチ APIで書籍情報を検索
4. NDLサーチで表紙画像が取得できない場合、Google Books APIを使用
5. 書籍情報（タイトル、表紙画像）を取得してデータベースに保存
6. 登録成功時: 「とうろくしました！」メッセージを表示し、メニュー画面に戻る
7. 書籍が見つからない場合: 「みつかりませんでした」メッセージを表示し、メニュー画面に戻る

**使用ライブラリ**: JavaScriptバーコードスキャンライブラリ（例: QuaggaJS, html5-qrcode等）

#### 3.2.3 本の登録画面（手動入力）

**目的**: ISBNコードを手動入力して本を登録

**表示要素**:
- ISBNコード入力欄（数字のみ）
- 「とうろくする」ボタン
- 「メニューにもどる」ボタン

**動作**:
1. ISBNコードを入力
2. 「とうろくする」ボタンをタップ
3. バーコードスキャンと同様の処理（NDLサーチ → Google Books API）
4. 登録成功/失敗時の動作はバーコードスキャンと同様

#### 3.2.4 本の一覧画面

**目的**: 登録済みの本を一覧表示・削除

**表示要素**:
- 並び順選択（「あたらしいじゅん」/「あいうえおじゅん」）
- 本のリスト（表紙画像 + タイトル）
- 各本に「さくじょ」ボタン
- 「メニューにもどる」ボタン

**動作**:
1. デフォルト: 登録日時の新しい順で表示
2. 並び順選択で「あいうえおじゅん」を選択すると、タイトルの50音順で表示
3. 「さくじょ」ボタンをタップすると、確認メッセージ「ほんとうにさくじょしますか？」を表示
4. 「はい」を選択すると本を削除し、一覧を更新
5. 「いいえ」を選択すると削除をキャンセル

#### 3.2.5 検索画面

**目的**: 本のタイトルで部分一致検索

**表示要素**:
- 検索ボックス（タイトル入力欄）
- 「けんさくする」ボタン
- 検索結果リスト（表紙画像 + タイトル）
- 「メニューにもどる」ボタン

**動作**:
1. タイトルの一部を入力
2. 「けんさくする」ボタンをタップ
3. 登録済みの本からタイトルの部分一致で検索
4. 検索結果を一覧表示（表紙画像 + タイトル）
5. 該当する本がない場合: 「みつかりませんでした」メッセージを表示

## 4. 非機能要件

### 4.1 UI/UX要件

- **文字表示**: 操作に必要なボタンやラベルはひらがな表記
- **本の情報**: 取得したタイトルや著者名はそのまま表示（漢字・カタカナ含む）
- **ボタンサイズ**: 小学校低学年の子供が操作しやすい大きいサイズ
- **配色**: パステルカラーを基調とした優しい色合い
- **レスポンシブ**: スマートフォン・タブレット・パソコンに対応

### 4.2 パフォーマンス要件

- ページ読み込み時間: 3秒以内
- バーコードスキャン: リアルタイム認識
- API応答時間: 5秒以内（タイムアウト設定）

### 4.3 セキュリティ要件

- 家庭内ネットワークのみからのアクセス制限
- SQLインジェクション対策（Djangoの標準機能を使用）
- XSS対策（Reactの標準機能を使用）

### 4.4 可用性要件

- サーバー起動時のみ利用可能
- データベースバックアップ機能（オプション）

## 5. データモデル

### 5.1 テーブル設計

#### 5.1.1 Bookテーブル

| カラム名 | データ型 | 制約 | 説明 |
|---------|---------|------|------|
| id | INTEGER | PRIMARY KEY, AUTO INCREMENT | 本ID |
| isbn | VARCHAR(13) | UNIQUE, NOT NULL | ISBNコード |
| title | VARCHAR(255) | NOT NULL | 本のタイトル |
| cover_image_url | TEXT | NULL | 表紙画像URL |
| created_at | TIMESTAMP | NOT NULL, DEFAULT NOW() | 登録日時 |

### 5.2 データ保持期間

- 全データ: ユーザーが削除するまで永続的に保存

## 6. 外部API仕様

### 6.1 NDLサーチ OpenSearch API

- **エンドポイント**: https://iss.ndl.go.jp/api/opensearch
- **検索方法**: ISBNコードで書籍情報を検索
- **取得情報**: タイトル、著者、表紙画像URL（可能な場合）

### 6.2 Google Books API（フォールバック）

- **エンドポイント**: https://www.googleapis.com/books/v1/volumes
- **検索方法**: ISBNコードで書籍情報を検索
- **取得情報**: タイトル、著者、表紙画像URL
- **使用条件**: NDLサーチで表紙画像が取得できない場合のみ

## 7. エラーハンドリング

### 7.1 エラーケースと対応

| エラーケース | メッセージ | 動作 |
|------------|-----------|------|
| ISBNで書籍が見つからない | 「みつかりませんでした」 | メニュー画面に戻る |
| APIタイムアウト | 「みつかりませんでした」 | メニュー画面に戻る |
| バーコード読み取り失敗 | 「もういちどためしてください」 | スキャン画面に留まる |
| ネットワークエラー | 「つながりませんでした」 | メニュー画面に戻る |
| データベースエラー | 「エラーがおきました」 | メニュー画面に戻る |

### 7.2 エラー発生時の共通動作

- 全てのエラー発生時、「メニューにもどる」ボタンを表示
- エラーメッセージはひらがな表記で子供にも理解しやすい表現

## 8. 画面遷移図

```
メニュー画面
├── 本の登録画面（バーコード） → 登録完了 → メニュー画面
├── 本の登録画面（手動入力） → 登録完了 → メニュー画面
├── 本の一覧画面 → 削除確認 → 削除完了 → 本の一覧画面
│                └── メニュー画面
└── 検索画面 → メニュー画面
```

## 9. 開発スケジュール（参考）

| フェーズ | タスク | 期間（目安） |
|---------|--------|------------|
| Phase 1 | Docker環境構築・DB設計 | 1週間 |
| Phase 2 | バックエンドAPI開発（Django + PostgreSQL） | 2週間 |
| Phase 3 | フロントエンド開発（React + API連携） | 3週間 |
| Phase 4 | テスト・デバッグ（各コンテナ統合テスト） | 1週間 |
| Phase 5 | Docker Compose最適化・動作確認 | 1週間 |

**合計**: 約8週間

### Phase 1詳細（Docker環境構築）
- Docker Composeファイルの作成
- 各コンテナのDockerfile作成
- PostgreSQL初期設定
- ネットワーク・ボリューム設定
- データベーステーブル設計

## 10. 今後の拡張案（オプション）

- 読書感想文の記録機能
- 読書冊数の統計・グラフ表示
- 複数ユーザー対応（家族で使えるように）
- 読書バッジ・スタンプ機能
- おすすめ本の表示機能

## 11. 運用・保守

### 11.1 起動・停止手順

**起動**:
```bash
cd bokuno-dokusho-kiroku
docker-compose up -d
```

**停止**:
```bash
docker-compose down
```

**ログ確認**:
```bash
docker-compose logs -f [frontend|backend|db]
```

### 11.2 データバックアップ

**PostgreSQLのバックアップ**:
```bash
docker exec db pg_dump -U user books_db > backup_$(date +%Y%m%d).sql
```

**バックアップからの復元**:
```bash
cat backup_20260210.sql | docker exec -i db psql -U user books_db
```

### 11.3 トラブルシューティング

| 問題 | 原因 | 対処法 |
|------|------|--------|
| コンテナが起動しない | ポートの競合 | 他のアプリケーションを停止 |
| データベース接続エラー | dbコンテナ未起動 | `docker-compose restart db` |
| フロントエンドが表示されない | ビルドエラー | `docker-compose logs frontend` でログ確認 |
| APIが応答しない | バックエンドエラー | `docker-compose logs backend` でログ確認 |

### 11.4 アップデート手順

```bash
# コンテナ停止
docker-compose down

# 最新コードを取得（Gitを使用する場合）
git pull

# イメージ再ビルド
docker-compose build

# コンテナ起動
docker-compose up -d
```

---

**作成日**: 2026年2月10日  
**バージョン**: 1.0
